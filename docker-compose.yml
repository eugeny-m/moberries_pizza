version: '3.7'

services:

#  nginx:
#    image: nginx:1.17.5
#    container_name: nginx
#    ports:
#      - 80:80
#    volumes:
#      - ./nginx_server.conf:/etc/nginx/conf.d/default.conf
#      - ./places_app/static:/opt/www/static
#      - ./robots.txt:/opt/www/robots.txt
#      - /tmp/images:/opt/www/images
#      # should be the same as uwsgi_cache_path in nginx_server.conf
#      - /tmp/nginx/cache:/opt/www/nginx/cache

  # django gunicorn
  moberries_pizza:
    build: .
    image: moberries_pizza:latest
    volumes:
      - /opt/www/moberries/conf:/opt/www/conf
      - /opt/www/moberries/static:/opt/www/static
    command: gunicorn -w 4 -k uvicorn.workers.UvicornWorker asgi:application
    restart: always
    depends_on:
      - db

  db:
    image: postgres:12.0-alpine
    volumes:
      - /tmp/postgres12:/var/lib/postgresql/data/
